[TOC]

# 函数

函数：输入某一值得到相应输出结果功能，输入值称 **参数**，输出值称为 **返回值**

大致分以下几种：

- 算术：进行数值计算
- 字符串：进行字符串操作
- 日期：日期操作
- 转换：转换数据类型和值
- 聚合：进行数据聚合

## 字符串

- `LENGTH`：字符串长度

    ```sql
    LENGTH(str)
    ```

    > **注意**：该函数无法在 SQL Server 使用，SQL Server 使用 `LEN` 计算字符串长度
    >
    > 该函数与半角英文占用 1 字节不同，汉字全角字符占用 2 字节，不同 DBMS 的执行结果也不尽相同

- `CONCAT(str1, str2)`：字符串拼接

    ```sql
    CONCAT('hello', ' world')
    ```

    > **注意**：如果包含 NULL，那么得到的结果也是 `NULL`
    >
    > **|| 函数在 SQL Server 和 MySQL 无法使用**
    >
    > **SQL Server：使用 `+` 号连接字符串**
    >
    > ```sql
    > str1 + str2
    > ```
    >
    > **MySQL：使用 CONCAT 完成字符串拼接**
    >
    > ```sql
    > CONCAT(str1, str2)
    > ```

- `LOWER` / `UPPER`：小写 / 大写转换

  ```sql
  LOWER / UPPER (str)
  ```

  > **注意**：**只能针对英文字母使用，将参数中的字符串全都转换为小写**
  >
  > **并不适用于英文字母以外的场合**

- `TRIM(str)、LTRIM / RTRIM(str)`：删除空格

  ```sql
  TRIM(str)
  ```

- `REPLACE`：字符串转换

  ```sql
  REPLACE (str, 替换前字符串, 替换后字符串)
  ```

- `SUBSTRING`：字符串截取

  ```sql
  SUBSTRING (str FROM 截取起始位置 FOR 截取的字符串)
  ```

  使用 `SUBSTRING` 截取出字符串中的一部分字符串

  截取的起始位置从字符串最左侧开始计算

  > **注意**：**只有 PostgreSQL 和 MySQL ** 支持该语法
  >
  > **SQL Server**
  >
  > ```sql
  > SUBSTRING (str, 截取起始位置, 截取字符数)
  > ```
  >
  > **Oracle 和 DB2**
  >
  > ```sql
  > SUBSTR (str, 截取起始位置, 截取字符数)
  > ```

## 日期时间

其中大部分都依存于各自的 DBMS

- `CURRENT_DATE` / `CURDATE()`：**当前日期**，由于没有参数，因此无需使用括号

  ```sql
  CURRENT_DATE
  ```

  > **无法在 SQL Server 中执行，Oracle 和 DB2 中的语法略有不同**
  >
  > **SQL Server**：**CURRENT_TIMESTAMP** 
  >
  > ```sql
  > SELECT CAST(CURRENT_TIMESTAMP AS DATE) AS CUR_DATE;
  > ```
  >
  > **Oracle**：需要在 FROM 指定临时表（DUAL）
  >
  > 而在 **DB2** 中使用时，需要在 CRUUENT 和 DATE 之间添加半角空格
  >
  > 并需要指定临时表 `SYSIBM.SYSDUMMY1`
  >
  > ```sql
  > -- Oracle
  > SELECT
  > 	CURRENT_DATE
  > FROM
  > 	dual;
  > 
  > -- DB2
  > SELECT
  > 	CURRENT DATE
  > FROM
  > 	SYSIBM.SYSDUMMY1;
  > ```

- `CURRENT_TIME`：**当前时间**

  ```sql
  CURRENT_TIME
  ```

  > **SQL Server**
  >
  > ```sql
  > SELECT CAST(CURRENT_TIMESTAMPE AS TIME) AS CUR_TIME;
  > ```
  >
  > **Oracle** 和 **DB2**
  >
  > ```sql
  > -- Oracle
  > SELECT
  > 	CURRENT_TIMESTAMPE
  > FROM
  > 	dual;
  > 
  > -- DB2
  > SELECT
  > 	CURRENT TIME
  > FROM
  > 	SYSIBM.SYSDUMMY1;
  > ```

- `CURRENT_TIMESTAMP` / `LOCALTIME()` / `NOW()` / `SYSDATE()`：**当前日期和时间**

  ```sql
  CURRENT_TIMESTAMP
  ```

  具有 CURRENT_DATE + CURRENT_TIME 的功能，同时得到当前日期和时间

  > **在 SQL Server 等各个主要的 DBMS 中使用** 
  >
  > **在 Oracle 和 DB2 中该函数的语法略有不同**
  >
  > ```sql
  > -- Oracle
  > SELECT
  > 	CURRENT_TIMESTAMPE 
  > FROM
  > 	dual;
  > 	
  > -- DB2
  > SELECT CURRENT TIMESTAMP 
  > FROM
  > 	SYSIBM.SYSDUMMY1;
  > ```

- `UTC_DATE` / `UTC_TIMESTAMP` / `UTC_TIME`：获取 UTC 日期时间

    ```sql
    UTC_DATE
    ```

- `DATE_FORMAT(date, format)`：日期时间格式化
    
    | 格式 | 描述 |
    | --- | --- |
    | %y / %Y | 年，2 / 4 位 |
    | %m / %M | 月，2位 / 名称 |
    | %d / %D | 年，2位 / 每月第几天 |
    | %h / %I | 12 小时制 |
    | %H | 24 小时制 |
    | %i | 分钟 |
    | %s / %S | 秒 |

    ```sql
    DATE_FORMAT(CURRENT_TIMESTAMP, '%y年%m月%d天');

    DATE_FORMAT(CURRENT_TIME, '%H小时%i分钟%s秒');
    ```

## 日期时间计算函数

| 单位选项 | 含义 |
| --- | --- |
| YEAR | 年 |
| MONTH | 月 |
| DAY | 日 |
| HOUR | 小时 |
| MINUTE | 分钟 |
| SECOND | 秒钟 |
| MICROSECOND | 微秒 |

- `DATE_ADD` / `ADDDATE`：日期增加

    ```sql
    DATE_ADD(date, INTERVAL expr unit)

    SELECT CURRENT_TIMESTAMP, DATE_ADD(CURRENT_TIMESTAMP, INTERVAL 1 HOUR);
    ```

- `DATE_SUB` / `SUBDATE`：日期增加

    ```sql
    DATE_SUB(date, INTERVAL expr unit);
    ```

- `ADDTIME` / `SUBTIME`：时间加减

    ```sql
    ADDTIME(expr1, expr2);

    SELECT CURRENT_TIME, ADDTIME(CURRENT_TIME, "00:05:00");
    ```

## 聚合统计

- `COUNT`：统计总行数

    ```sql
    SELECT COUNT(column_name) FROM table
    ```
  
- `MAX` / `MIN`：指定列的最大 / 最小值

    ```sql
    SELECT MAX / MIN(column_name) FROM table
    ```

- `SUM`：指定列的总和

    ```sql
    SELECT SUM()
    ```

- `AVG`：指定列的平均数

## 数学

## 其他常用