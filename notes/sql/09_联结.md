[TOC]

# 表联结

将其他表中的列添加过来，进行 "添加列" 运算，用于无法从一张表中获取期望数据（列）的情况

## 内联结

只要符合连接条件的记录

语法参考：

1. `SELECT * FROM table1 JOIN table2 ON join_condition;`
2. `SELECT * FROM table1 JOIN table2 WHERE join_condition;`
3. `SELECT * FROM table1, table2 WHERE join_condition;`

- 内联结要点 1：`FROM`

  之前的 `FROM` 只有一张表，而同时使用两张表

    ```sql
    FROM table1 AS t1 INNER JOIN table2 AS t2
    ```

  使用关键字 `INNER JOIN` 将两张表联结一起，分别为表设置别名（不是必须）

  `FROM` 使用表的别名时， `AS` 虽为标准语法，**但不适用于 Oracle**

- 内联结要点 2：`ON`

  注意 `ON` 后的联结条件

    ```sql
    ON t1.stu_on = t2.id;
    ```

  `ON` 之后指定两张表联结所使用的列（联结键），用来指定**联结条件**

  与 `WHERE` 起到相同作用，需要指定多个键时，可使用 `AND` / `OR`

  在进行内联结时 `ON` 是必不可少的，并且 `ON` 必须书写在 `FROM` 和 `WHERE` 之间

- 内联结要点 3：`SELECT`

    ```sql
    SELECT
        t1.stu_no,
        t1.stu_name,
        t2.score
    ```

  使用 `table.as_name` 形式指定列，可避免读法混乱

## 自联结

使用场景：在 SELECT 语句中多次引用相同的表

当需要在同个表不同数据的时候使用

```sql
SELECT
    t1.comment AS '评论',
        t2.reply AS '回复'
FROM
    comments_t AS t1, comments_t AS t2;
WHERE
    t2.parent_id = t1.id;
```

## 外联结

查询全部的记录（不符合条件的也要）

外联结也通过 `ON` 的联结键将两张表进行联结，并从两张表中同时选取相应列

基本使用方法与内联结相同，只是结果却有所不同

```sql
SELECT
    t1.stu_id,
    t1.stu_name,
    t2.score
FROM
    table1 AS t1
        RIGHT OUTER JOIN table2 AS t2 ON t1.id = t2.student_id;
```

- 外联结要点 1：选取出单张表中全部信息

    对于外联结，只要数据存在于某张表中，就能读取出来

    外联结名称的由来跟 NULL 有关，即 “结果中包含原表中不存在（原表之外）的信息”

- 外联结要点 2：每张表都是主表？

    如果把那张表作为主表，最终结果中会包含主表内所有数据

    指定主表的关键字是 `LEFT` 和 `RIGHT`，使用那个方向，那个方向的表就是主表

    > 使用两者所得到的结果完全相同，连接表的数量并没有限制

外联结分为三种：

1. 左外联结：LEFT OUTER JOIN
2. 右外联结：RIGHT OUTER JOIN
3. 全联结：FULL JOIN （MySQL 不支持）

## 结果集联结

对满足统一规则的记录进行四则运算，使用 `UNION（并集）`、`INTERSECT（交集）`、`EXCEPT（差集）`进行集合运算

**集合**：在数学领域表示事物的总和，在数据库领域表示 **记录集合**

具体：表、视图和查询的执行结果都是记录的集合

通过集合运算，可得到两张表中记录的集合或公共记录的集合，或其中某张表的记录集合

### UNION：并集

```sql
-- 根据列查询两张表的并集：去除重复记录
SELECT column_name1, column_name2
FROM table1
UNION
SELECT column_name1, column_name2
FROM table2;
```

> `UNION ALL`：保留重复的记录

### INTERSECT：交集

应用与两张表，选取出当中的公共记录，其注意事项与 `UNION` 相同

```sql
SELECT column_name1, column_name2
FROM table1
INTERSECT
SELECT column_name1, column_name2
FROM table2;
```

### EXCEPT：差集

其语法与 `UNION` 相同

```sql
SELECT column_name1, column_name2
FROM table1
EXCEPT
SELECT column_name1, column_name2
FROM table2;
```

> **注意**：Oracle 不适用 `EXCEPT`，而使用 `MINUS`
> 
> MySQL 不支持 `EXCEPT`
> 
> **`EXCEPT` 与 `UNION / INTERSECT` 不同，减法运算和被减数的位置不同，所得到的结果也不同**

### 注意事项

1. 作为运算对象的记录列必须相同

    一部分记录包含 2 列，另一部分记录包含 3 列时发生错误，无法进行运算

2. 作为运算对象记录中列类型必须一致

    从左侧开始，两个 `SELECT` 相同位置上的列必须为统一数据类型

    > 如果一定使用不同数据类型的列时，需使用转换函数 `CAST`

3. 可使用任何 `SELECT` 语句，但 `ORDER BY` 只能在最后使用一次

    通过 `UNION` 进行并集运算时可使用任何形式的 `SELECT` 语句（`WHERE / GROUP BY / HAVING 等`）
    
    但 `ORDER BY` 只能在最后使用一次

4. 包含重复行的集合运算 —— ALL
    
    在 `UNION` 的结果中保留重复行的语法

    只需在 `UNION` 后添加 `ALL` 关键字即可，在其他集合运算符同样适用