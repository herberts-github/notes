[TOC]

# SQL 语法基础

结构化查询语言，特殊目的的编程语言，**数据库查询**和**程序设计**语言

> 用于存储数据以及查询、更新和管理关系数据库系统

## 创建并使用数据库

```sql
-- 创建数据库
CREATE DATABASE `test_database

-- 切换数据库
USE `test_database`;

-- 查看已有的数据库名称
SHOW DATABASES;
```

## 表的创建与修改

```sql
-- 建表
CREATE TABLE `my_user`(
	`id` INT NOT NULL,
	`name` VARCHAR(200) NOT NULL
);

-- 修改数据表
-- 新增列
ALTER TABLE `my_user` ADD `column_name`;
-- 删除列
ALTER TABLE `my_user` DROP `column_name`;
-- 修改列
ALTER TABLE `my_user` CHANGE COLUMN `column_name1` `column_name2`;

-- 添加主键、自动递增
CREATE TABLE `my_user` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(200) UNIQUE NOT NULL,
    PRIMARY KEY(`id`)
)
```

### 索引

用来提高 MySQL 的检索速度

**分类**

- 普通索引
- 唯一索引
- 主键索引
- 外键关联索引

```sql
-- 创建索引
CREATE INDEX index_name ON table_name(column_name)
```

## 查询操作

- SELECT：列举从表中查询出的列名称
- FROM：指定选取出数据的表名称

> **查询结果中列的顺序与 `SELECT` 中的顺序相同**

```sql
SELECT column1, ... FROM table [WHERE where_definition];
```

> 也可通过 `WHERE` 查询符号指定条件的记录，然后再选取出 `SELECT` 指定的列

查询全部列时，可使用代表所有列的 **星号（*）**

```sql
SELECT * FROM 表名;
```

### 为列设定别名

使用 `AS` 为列设定 **别名**

```sql
SELECT column1 AS as_name1,
    column2 AS as_name2
FROM table;
```

> 别名可使用中文，但需要 **双引号** 括起



## 插入操作

```sql
-- 将列名和值用逗号隔开，分别括在括号中
INSERT INTO table (column1, column2, ...) VALUES (value1, value2, ...);
```

在对表全列 `INSERT` 时，**可省略数据表的列名，值会默认按照从左到右顺序** 赋给每列

```sql
INSERT INTO table
VALUES (value1, value2, value3),
       (value1, value2, value3),
       (value1, value2, value3);
```

> **注意：多行 INSERT 不适用于 Oracle**
> ```sql
> -- Oracle
> INSERT ALL INTO table
> VALUES
>       (value1, value2, ...),
> INTO table VALUES
>       (value1, value2, ...)
> SELECT * FROM DUAL
> ```
> `DUAL` 是 Oracle 特有临时表，
> 在书写参照表的 `SELECT` 时，写在 `FROM` 子句的表，
> 
> 没有实际意义，也不保存任何数据，同时不能作为 `INSERT` 和 `UPDATE` 的对象

### 插入默认值

在创建数据表时向表插入 **默认值（初始值）**，通过 `CREATE TABLE` 中设置 **DEFAULT 约束** 来设定默认值

- 显式插入

    ```sql
    INSERT INTO table(column1, column2, column3)
    VALUES 
        (value1, value2, DEFAULT)
    ```

- 隐式插入

    ```sql
    -- 在列和值中省略设定默认值的列
    INSERT INTO  table(column1, column2)
    VALUES
        (value1, value2)
    ```

> **为了容易理解，建议显式插入**
> 
> **省略 INSERT 列明，会自动设定为该列的默认值（没有默认值时设定 NULL）**

### 复制数据

使用 `INSERT ... SELECT` 时，会将 `FROM` 表中根据列名完全相同的插入 `Copy` 表中

```sql
INSERT INTO Copy_table (column1, column2) SELECT
    column1,
    column2
FROM
    table;
```

也可同时利用 `GROUP BY` 将列分组后进行插入 `Copy` 表中

```sql
INSERT INTO Copy_table (column1, column2)
SELECT
    column1,
    SUM (column2),
FROM
    table
GROUP BY
    column1;
```

> **注意：`INSERT` 的 `SELECT` 可使用 `WHERE` 或 `GROUP BY` 任何SQL语句**
>
> **但使用 `ORDER BY` 并不会产生任何效果**

## 更新操作

```sql
-- 可根据 WHERE 条件指定更新数据
UPDATE table SET column1=expr1, ... [WHERE where_definition];

-- NULL 更新
UPDATE table SET column = NULL;
```

> 只有未设置 `NOT NULL` 约束和主键约束的列才可清空为 `NULL`

## 删除操作

1. **DROP TABLE**：将表完全删除

    完全删除整张表，删除后再插入必须重新创建表

    ```sql
    DROP TABLE table;
    ```

2. **DELETE**：留下容器，删除表中数据

    DELETE 删除对象并不是表或列，而是记录（行）

    ```sql
    DELETE FROM table [WHERE where_definition];
    ```

    可根据 **WHERE** 指定对象条件删除数据

    > `DELETE` 不能像 `SELECT` 使用 `GROUP BY`、`HAVING`、`ORDER BY`，而只能使用 `WHERE`
    >
    > 因为 `GROUP BY`、`HAVING` 是从表中选取数据改变抽取数据形式，而 `ORDER BY` 是指定取得结果后显示的顺序

> 在防止误删情况下，可使用逻辑删除：在设计数据表时创建 `is_valid` 字段，用以判断表内的数据是否有效
> ```sql
> -- 逻辑删除
> ALTER TABLE `account_user` ADD `is_valid` TINYINT(1) DEFAULT(1);
> ```

3. **TRUNCATE**

```sql
TRUNCATE table;
```

只能删除表中的全部数据，而不能通过 `WHERE` 指定条件删除部分数据

> Oracle 中定义为 DDL ，而不是 DML，不能通过 `ROLLBACK` 回滚操作，执行同时默认 `COMMIT` 操作